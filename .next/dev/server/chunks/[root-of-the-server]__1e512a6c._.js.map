{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/pvsameerpvs/Projects/JustSearch/just-search-lead-automation/just-search-platform-2-complete/lib/schemas.ts"],"sourcesContent":["import { z } from \"zod\";\n\nexport const LoginSchema = z.object({\n  username: z.string().min(2),\n  password: z.string().min(4),\n});\n\nexport const PullLeadsSchema = z.object({\n  industries: z.array(z.string()).min(1),\n  areas: z.array(z.string()).min(1),\n  limit: z.number().int().min(1).max(500).default(100),\n});\n\nexport const SendMessageSchema = z.object({\n  client_id: z.string().min(1),\n  campaign_id: z.string().min(1),\n  channel: z.enum([\"whatsapp\", \"email\", \"both\"]),\n  message: z.string().min(5),\n  lead_ids: z.array(z.string()).min(1),\n});\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEO,MAAM,cAAc,qSAAC,CAAC,MAAM,CAAC;IAClC,UAAU,qSAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACzB,UAAU,qSAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAC3B;AAEO,MAAM,kBAAkB,qSAAC,CAAC,MAAM,CAAC;IACtC,YAAY,qSAAC,CAAC,KAAK,CAAC,qSAAC,CAAC,MAAM,IAAI,GAAG,CAAC;IACpC,OAAO,qSAAC,CAAC,KAAK,CAAC,qSAAC,CAAC,MAAM,IAAI,GAAG,CAAC;IAC/B,OAAO,qSAAC,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,KAAK,OAAO,CAAC;AAClD;AAEO,MAAM,oBAAoB,qSAAC,CAAC,MAAM,CAAC;IACxC,WAAW,qSAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC1B,aAAa,qSAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC5B,SAAS,qSAAC,CAAC,IAAI,CAAC;QAAC;QAAY;QAAS;KAAO;IAC7C,SAAS,qSAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,UAAU,qSAAC,CAAC,KAAK,CAAC,qSAAC,CAAC,MAAM,IAAI,GAAG,CAAC;AACpC"}},
    {"offset": {"line": 170, "column": 0}, "map": {"version":3,"sources":["file:///home/pvsameerpvs/Projects/JustSearch/just-search-lead-automation/just-search-platform-2-complete/lib/googleSheets.ts"],"sourcesContent":["import { google } from \"googleapis\";\nimport path from \"path\";\nimport fs from \"fs\";\n\nfunction getAuth() {\n  const raw = process.env.GOOGLE_SERVICE_ACCOUNT_JSON;\n  if (!raw) throw new Error(\"Missing GOOGLE_SERVICE_ACCOUNT_JSON\");\n  let credentials: any;\n  try { credentials = JSON.parse(raw); } \n  catch { throw new Error(\"GOOGLE_SERVICE_ACCOUNT_JSON must be valid JSON string\"); }\n\n  return new google.auth.GoogleAuth({\n    credentials,\n    scopes: [\"https://www.googleapis.com/auth/spreadsheets\"],\n  });\n}\n\nexport function sheetsClient() {\n  const auth = getAuth();\n  return google.sheets({ version: \"v4\", auth });\n}\n\nexport const SHEET_ID = () => {\n  const id = process.env.GOOGLE_SHEET_ID;\n  if (!id) throw new Error(\"Missing GOOGLE_SHEET_ID\");\n  return id;\n};\n\nexport async function readRange(range: string) {\n  const sheets = sheetsClient();\n   console.info(\"attempt to read range\", range);\n  const res = await sheets.spreadsheets.values.get({ spreadsheetId: SHEET_ID(), range });\n console.info(\"read range\", range);\n  return res.data.values ?? [];\n}\n\nexport async function appendRow(range: string, values: any[]) {\n  const sheets = sheetsClient();\n  await sheets.spreadsheets.values.append({\n    spreadsheetId: SHEET_ID(),\n    range,\n    valueInputOption: \"RAW\",\n    requestBody: { values: [values] },\n  });\n}\n\nexport async function updateRow(range: string, values: any[]) {\n  const sheets = sheetsClient();\n  await sheets.spreadsheets.values.update({\n    spreadsheetId: SHEET_ID(),\n    range,\n    valueInputOption: \"RAW\",\n    requestBody: { values: [values] },\n  });\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AAIA,SAAS;IACP,MAAM,MAAM,QAAQ,GAAG,CAAC,2BAA2B;IACnD,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,IAAI;IACJ,IAAI;QAAE,cAAc,KAAK,KAAK,CAAC;IAAM,EACrC,OAAM;QAAE,MAAM,IAAI,MAAM;IAA0D;IAElF,OAAO,IAAI,gRAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QAChC;QACA,QAAQ;YAAC;SAA+C;IAC1D;AACF;AAEO,SAAS;IACd,MAAM,OAAO;IACb,OAAO,gRAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM;IAAK;AAC7C;AAEO,MAAM,WAAW;IACtB,MAAM,KAAK,QAAQ,GAAG,CAAC,eAAe;IACtC,IAAI,CAAC,IAAI,MAAM,IAAI,MAAM;IACzB,OAAO;AACT;AAEO,eAAe,UAAU,KAAa;IAC3C,MAAM,SAAS;IACd,QAAQ,IAAI,CAAC,yBAAyB;IACvC,MAAM,MAAM,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QAAE,eAAe;QAAY;IAAM;IACrF,QAAQ,IAAI,CAAC,cAAc;IAC1B,OAAO,IAAI,IAAI,CAAC,MAAM,IAAI,EAAE;AAC9B;AAEO,eAAe,UAAU,KAAa,EAAE,MAAa;IAC1D,MAAM,SAAS;IACf,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;QACtC,eAAe;QACf;QACA,kBAAkB;QAClB,aAAa;YAAE,QAAQ;gBAAC;aAAO;QAAC;IAClC;AACF;AAEO,eAAe,UAAU,KAAa,EAAE,MAAa;IAC1D,MAAM,SAAS;IACf,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;QACtC,eAAe;QACf;QACA,kBAAkB;QAClB,aAAa;YAAE,QAAQ;gBAAC;aAAO;QAAC;IAClC;AACF"}},
    {"offset": {"line": 252, "column": 0}, "map": {"version":3,"sources":["file:///home/pvsameerpvs/Projects/JustSearch/just-search-lead-automation/just-search-platform-2-complete/app/api/auth/login/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport bcrypt from \"bcryptjs\";\nimport { LoginSchema } from \"@/lib/schemas\";\nimport { readRange } from \"@/lib/googleSheets\";\n\n// Users sheet columns (shared with Platform 1):\n// A user_id | B name | C email | D username | E password_hash | F role | G status\nexport async function POST(req: Request) {\n  const body = await req.json().catch(() => ({}));\n  const parsed = LoginSchema.safeParse(body);\n  if (!parsed.success) return NextResponse.json({ error: \"Invalid input\" }, { status: 400 });\n\n  try {\n    const { username, password } = parsed.data;\n    console.info(\"Login attempt for\", username);\n    const rows = await readRange(\"Users!A2:G\");\n     console.info(\"rows from google sheet users\", username);\n\n    const row = rows.find((r) => {\n      const email = (r?.[2] ?? \"\").toString().toLowerCase();\n      const uname = (r?.[3] ?? \"\").toString().toLowerCase();\n      const input = username.toLowerCase();\n      return email === input || uname === input;\n      \n      \n    });\n\n    if (!row) {\n      console.log(\"Login failed: User not found in sheet for input:\", username);\n      return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 });\n    }\n\n    const role = (row?.[5] ?? \"\").toString().toLowerCase().trim();\n    const status = (row?.[6] ?? \"active\").toString().toLowerCase().trim();\n\n    console.log(`Login attempt for ${username}: Found role='${role}', status='${status}'`);\n\n    if (role !== \"client\") {\n      console.log(`Login failed: Role mismatch. Expected 'client', got '${role}'`);\n      return NextResponse.json({ error: \"Not a client account\" }, { status: 403 });\n    }\n\n    if (status !== \"active\") {\n      console.log(`Login failed: Status mismatch. Expected 'active', got '${status}'`);\n      return NextResponse.json({ error: \"Account inactive\" }, { status: 403 });\n    }\n\n    const hash = (row?.[4] ?? \"\").toString();\n    const ok = await bcrypt.compare(password, hash).catch(() => false);\n    if (!ok) {\n      console.log(\"Login failed: Password mismatch for user:\", username); \n      return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 });\n    }\n\n    const res = NextResponse.json({ ok: true, client_id: (row?.[0] ?? \"\").toString(), name: (row?.[1] ?? \"\").toString() });\n    res.cookies.set(\"js_client_session\", \"ok\", { httpOnly: true, sameSite: \"lax\", path: \"/\" });\n    return res;\n  } catch (error: any) {\n    console.error(\"Login API Error:\", error);\n    return NextResponse.json({ error: \"Internal Server Error\", details: error.message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAIO,eAAe,KAAK,GAAY;IACrC,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;IAC7C,MAAM,SAAS,gPAAW,CAAC,SAAS,CAAC;IACrC,IAAI,CAAC,OAAO,OAAO,EAAE,OAAO,iQAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAgB,GAAG;QAAE,QAAQ;IAAI;IAExF,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,OAAO,IAAI;QAC1C,QAAQ,IAAI,CAAC,qBAAqB;QAClC,MAAM,OAAO,MAAM,IAAA,mPAAS,EAAC;QAC5B,QAAQ,IAAI,CAAC,gCAAgC;QAE9C,MAAM,MAAM,KAAK,IAAI,CAAC,CAAC;YACrB,MAAM,QAAQ,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,EAAE,QAAQ,GAAG,WAAW;YACnD,MAAM,QAAQ,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,EAAE,QAAQ,GAAG,WAAW;YACnD,MAAM,QAAQ,SAAS,WAAW;YAClC,OAAO,UAAU,SAAS,UAAU;QAGtC;QAEA,IAAI,CAAC,KAAK;YACR,QAAQ,GAAG,CAAC,oDAAoD;YAChE,OAAO,iQAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,OAAO,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,EAAE,QAAQ,GAAG,WAAW,GAAG,IAAI;QAC3D,MAAM,SAAS,CAAC,KAAK,CAAC,EAAE,IAAI,QAAQ,EAAE,QAAQ,GAAG,WAAW,GAAG,IAAI;QAEnE,QAAQ,GAAG,CAAC,CAAC,kBAAkB,EAAE,SAAS,cAAc,EAAE,KAAK,WAAW,EAAE,OAAO,CAAC,CAAC;QAErF,IAAI,SAAS,UAAU;YACrB,QAAQ,GAAG,CAAC,CAAC,qDAAqD,EAAE,KAAK,CAAC,CAAC;YAC3E,OAAO,iQAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,IAAI,WAAW,UAAU;YACvB,QAAQ,GAAG,CAAC,CAAC,uDAAuD,EAAE,OAAO,CAAC,CAAC;YAC/E,OAAO,iQAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,OAAO,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,EAAE,QAAQ;QACtC,MAAM,KAAK,MAAM,+PAAM,CAAC,OAAO,CAAC,UAAU,MAAM,KAAK,CAAC,IAAM;QAC5D,IAAI,CAAC,IAAI;YACP,QAAQ,GAAG,CAAC,6CAA6C;YACzD,OAAO,iQAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,MAAM,iQAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,WAAW,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,EAAE,QAAQ;YAAI,MAAM,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,EAAE,QAAQ;QAAG;QACpH,IAAI,OAAO,CAAC,GAAG,CAAC,qBAAqB,MAAM;YAAE,UAAU;YAAM,UAAU;YAAO,MAAM;QAAI;QACxF,OAAO;IACT,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,iQAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAyB,SAAS,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrG;AACF"}}]
}