{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/pvsameerpvs/Projects/JustSearch/just-search-lead-automation/just-search-platform-2-complete/lib/schemas.ts"],"sourcesContent":["import { z } from \"zod\";\n\nexport const LoginSchema = z.object({\n  username: z.string().min(2),\n  password: z.string().min(4),\n});\n\nexport const PullLeadsSchema = z.object({\n  industries: z.array(z.string()).min(1),\n  areas: z.array(z.string()).min(1),\n  limit: z.number().int().min(1).max(500).default(100),\n});\n\nexport const SendMessageSchema = z.object({\n  client_id: z.string().min(1),\n  campaign_id: z.string().min(1),\n  channel: z.enum([\"whatsapp\", \"email\", \"both\"]),\n  message: z.string().min(5),\n  lead_ids: z.array(z.string()).min(1),\n});\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEO,MAAM,cAAc,qSAAC,CAAC,MAAM,CAAC;IAClC,UAAU,qSAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACzB,UAAU,qSAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAC3B;AAEO,MAAM,kBAAkB,qSAAC,CAAC,MAAM,CAAC;IACtC,YAAY,qSAAC,CAAC,KAAK,CAAC,qSAAC,CAAC,MAAM,IAAI,GAAG,CAAC;IACpC,OAAO,qSAAC,CAAC,KAAK,CAAC,qSAAC,CAAC,MAAM,IAAI,GAAG,CAAC;IAC/B,OAAO,qSAAC,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,KAAK,OAAO,CAAC;AAClD;AAEO,MAAM,oBAAoB,qSAAC,CAAC,MAAM,CAAC;IACxC,WAAW,qSAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC1B,aAAa,qSAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC5B,SAAS,qSAAC,CAAC,IAAI,CAAC;QAAC;QAAY;QAAS;KAAO;IAC7C,SAAS,qSAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,UAAU,qSAAC,CAAC,KAAK,CAAC,qSAAC,CAAC,MAAM,IAAI,GAAG,CAAC;AACpC"}},
    {"offset": {"line": 170, "column": 0}, "map": {"version":3,"sources":["file:///home/pvsameerpvs/Projects/JustSearch/just-search-lead-automation/just-search-platform-2-complete/lib/googleSheets.ts"],"sourcesContent":["import { google } from \"googleapis\";\n\nfunction getAuth() {\n  const raw = process.env.GOOGLE_SERVICE_ACCOUNT_JSON;\n  if (!raw) throw new Error(\"Missing GOOGLE_SERVICE_ACCOUNT_JSON\");\n  let credentials: any;\n  try { credentials = JSON.parse(raw); } \n  catch { throw new Error(\"GOOGLE_SERVICE_ACCOUNT_JSON must be valid JSON string\"); }\n\n  return new google.auth.GoogleAuth({\n    credentials,\n    scopes: [\"https://www.googleapis.com/auth/spreadsheets\"],\n  });\n}\n\nexport function sheetsClient() {\n  const auth = getAuth();\n  return google.sheets({ version: \"v4\", auth });\n}\n\nexport const SHEET_ID = () => {\n  const id = process.env.GOOGLE_SHEET_ID;\n  if (!id) throw new Error(\"Missing GOOGLE_SHEET_ID\");\n  return id;\n};\n\nexport async function readRange(range: string) {\n  const sheets = sheetsClient();\n  const res = await sheets.spreadsheets.values.get({ spreadsheetId: SHEET_ID(), range });\n  return res.data.values ?? [];\n}\n\nexport async function appendRow(range: string, values: any[]) {\n  const sheets = sheetsClient();\n  await sheets.spreadsheets.values.append({\n    spreadsheetId: SHEET_ID(),\n    range,\n    valueInputOption: \"RAW\",\n    requestBody: { values: [values] },\n  });\n}\n\nexport async function updateRow(range: string, values: any[]) {\n  const sheets = sheetsClient();\n  await sheets.spreadsheets.values.update({\n    spreadsheetId: SHEET_ID(),\n    range,\n    valueInputOption: \"RAW\",\n    requestBody: { values: [values] },\n  });\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AAEA,SAAS;IACP,MAAM,MAAM,QAAQ,GAAG,CAAC,2BAA2B;IACnD,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,IAAI;IACJ,IAAI;QAAE,cAAc,KAAK,KAAK,CAAC;IAAM,EACrC,OAAM;QAAE,MAAM,IAAI,MAAM;IAA0D;IAElF,OAAO,IAAI,gRAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QAChC;QACA,QAAQ;YAAC;SAA+C;IAC1D;AACF;AAEO,SAAS;IACd,MAAM,OAAO;IACb,OAAO,gRAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM;IAAK;AAC7C;AAEO,MAAM,WAAW;IACtB,MAAM,KAAK,QAAQ,GAAG,CAAC,eAAe;IACtC,IAAI,CAAC,IAAI,MAAM,IAAI,MAAM;IACzB,OAAO;AACT;AAEO,eAAe,UAAU,KAAa;IAC3C,MAAM,SAAS;IACf,MAAM,MAAM,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QAAE,eAAe;QAAY;IAAM;IACpF,OAAO,IAAI,IAAI,CAAC,MAAM,IAAI,EAAE;AAC9B;AAEO,eAAe,UAAU,KAAa,EAAE,MAAa;IAC1D,MAAM,SAAS;IACf,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;QACtC,eAAe;QACf;QACA,kBAAkB;QAClB,aAAa;YAAE,QAAQ;gBAAC;aAAO;QAAC;IAClC;AACF;AAEO,eAAe,UAAU,KAAa,EAAE,MAAa;IAC1D,MAAM,SAAS;IACf,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;QACtC,eAAe;QACf;QACA,kBAAkB;QAClB,aAAa;YAAE,QAAQ;gBAAC;aAAO;QAAC;IAClC;AACF"}},
    {"offset": {"line": 250, "column": 0}, "map": {"version":3,"sources":["file:///home/pvsameerpvs/Projects/JustSearch/just-search-lead-automation/just-search-platform-2-complete/app/api/auth/login/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport bcrypt from \"bcryptjs\";\nimport { LoginSchema } from \"@/lib/schemas\";\nimport { readRange } from \"@/lib/googleSheets\";\n\n// Users sheet columns (shared with Platform 1):\n// A user_id | B name | C email | D username | E password_hash | F role | G status\nexport async function POST(req: Request) {\n  const body = await req.json().catch(() => ({}));\n  const parsed = LoginSchema.safeParse(body);\n  if (!parsed.success) return NextResponse.json({ error: \"Invalid input\" }, { status: 400 });\n\n  const { username, password } = parsed.data;\n  const rows = await readRange(\"Users!A2:G\");\n\n  const row = rows.find((r) => {\n    const email = (r?.[2] ?? \"\").toString().toLowerCase();\n    const uname = (r?.[3] ?? \"\").toString().toLowerCase();\n    const input = username.toLowerCase();\n    return email === input || uname === input;\n  });\n\n  if (!row) {\n    console.log(\"Login failed: User not found in sheet for input:\", username);\n    return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 });\n  }\n\n  const role = (row?.[5] ?? \"\").toString().toLowerCase().trim();\n  const status = (row?.[6] ?? \"active\").toString().toLowerCase().trim();\n\n  console.log(`Login attempt for ${username}: Found role='${role}', status='${status}'`);\n\n  if (role !== \"client\") {\n    console.log(`Login failed: Role mismatch. Expected 'client', got '${role}'`);\n    return NextResponse.json({ error: \"Not a client account\" }, { status: 403 });\n  }\n\n  if (status !== \"active\") {\n    console.log(`Login failed: Status mismatch. Expected 'active', got '${status}'`);\n    return NextResponse.json({ error: \"Account inactive\" }, { status: 403 });\n  }\n\n  const hash = (row?.[4] ?? \"\").toString();\n  const ok = await bcrypt.compare(password, hash).catch(() => false);\n  if (!ok) {\n    console.log(\"Login failed: Password mismatch for user:\", username); \n    return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 });\n  }\n\n  const res = NextResponse.json({ ok: true, client_id: (row?.[0] ?? \"\").toString(), name: (row?.[1] ?? \"\").toString() });\n  res.cookies.set(\"js_client_session\", \"ok\", { httpOnly: true, sameSite: \"lax\", path: \"/\" });\n  return res;\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAIO,eAAe,KAAK,GAAY;IACrC,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;IAC7C,MAAM,SAAS,gPAAW,CAAC,SAAS,CAAC;IACrC,IAAI,CAAC,OAAO,OAAO,EAAE,OAAO,iQAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAgB,GAAG;QAAE,QAAQ;IAAI;IAExF,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,OAAO,IAAI;IAC1C,MAAM,OAAO,MAAM,IAAA,mPAAS,EAAC;IAE7B,MAAM,MAAM,KAAK,IAAI,CAAC,CAAC;QACrB,MAAM,QAAQ,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,EAAE,QAAQ,GAAG,WAAW;QACnD,MAAM,QAAQ,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,EAAE,QAAQ,GAAG,WAAW;QACnD,MAAM,QAAQ,SAAS,WAAW;QAClC,OAAO,UAAU,SAAS,UAAU;IACtC;IAEA,IAAI,CAAC,KAAK;QACR,QAAQ,GAAG,CAAC,oDAAoD;QAChE,OAAO,iQAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC3E;IAEA,MAAM,OAAO,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,EAAE,QAAQ,GAAG,WAAW,GAAG,IAAI;IAC3D,MAAM,SAAS,CAAC,KAAK,CAAC,EAAE,IAAI,QAAQ,EAAE,QAAQ,GAAG,WAAW,GAAG,IAAI;IAEnE,QAAQ,GAAG,CAAC,CAAC,kBAAkB,EAAE,SAAS,cAAc,EAAE,KAAK,WAAW,EAAE,OAAO,CAAC,CAAC;IAErF,IAAI,SAAS,UAAU;QACrB,QAAQ,GAAG,CAAC,CAAC,qDAAqD,EAAE,KAAK,CAAC,CAAC;QAC3E,OAAO,iQAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC5E;IAEA,IAAI,WAAW,UAAU;QACvB,QAAQ,GAAG,CAAC,CAAC,uDAAuD,EAAE,OAAO,CAAC,CAAC;QAC/E,OAAO,iQAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAmB,GAAG;YAAE,QAAQ;QAAI;IACxE;IAEA,MAAM,OAAO,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,EAAE,QAAQ;IACtC,MAAM,KAAK,MAAM,+PAAM,CAAC,OAAO,CAAC,UAAU,MAAM,KAAK,CAAC,IAAM;IAC5D,IAAI,CAAC,IAAI;QACP,QAAQ,GAAG,CAAC,6CAA6C;QACzD,OAAO,iQAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC3E;IAEA,MAAM,MAAM,iQAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAM,WAAW,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,EAAE,QAAQ;QAAI,MAAM,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,EAAE,QAAQ;IAAG;IACpH,IAAI,OAAO,CAAC,GAAG,CAAC,qBAAqB,MAAM;QAAE,UAAU;QAAM,UAAU;QAAO,MAAM;IAAI;IACxF,OAAO;AACT"}}]
}